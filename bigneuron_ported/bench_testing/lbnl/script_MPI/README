This is the instruction used to bench test 22 neuron tracing algorithms for BigNeuron project on hopper and edison at Lawrence Berkeley National Laboratory using MPI. Please use the command line to generate job scripts:

1. sh gen_bench_job_text_scripts.sh <tracing algorithm number> <input image path> <output folder path> <Vaa3D executable folder path> <output txt file path>
<tracing algorithm number>:  from 1 to 22.
<input image path>: the testing image path
<output folder path>: the output folder which is used to save the final tracing results
<Vaa3D executable folder path>: the pre-built Vaa3D folder
<output txt file path>: the text file including the tracing command line. should be named from 0 as: 0.txt, 1.txt,...

This is one example to generate all 2000 job text files for 2000 images using APP2 (tracing algorithm number=2). 2000 text files are saved as 0.txt, 1.txt, ..., at /global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/jobs_text/2/ folder:

cd /global/project/projectdirs/m2043/BigNeuron/first2000/images/
var=0;
for filename in `ls -d *`
do
	echo $filename
	echo $var
	sh gen_bench_job_text_scripts.sh 2 /global/project/projectdirs/m2043/BigNeuron/first2000/images/$filename/$filename /global/project/projectdirs/m2043/BigNeuron/
first2000/reconstructions/$filename/ /global/homes/z/zhizhou/bigneuron/BigNeuron_bench_test_LBNL_v1/Vaa3D_BigNeuron_version1 /global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/jobs_text/2/$var.txt
	var=$((var+1))	  		
done

2. sh gen_bench_c_exe_scripts.sh <output c file> <input text file folder> <Vaa3D executable folder path>
<output c file>: the c file, should has the extension ".c"
<input text file folder>: the folder including all text files (0.txt, 1.txt, . . .)
<Vaa3D executable folder path>: the pre-built Vaa3D folder

This is one example to generate a runVAA3D.c file, and then complile runVAA3D.c to a executable file runVAA3D.exe. Both runVaa3D.c and runVAA3D.exe are in the same folder (/global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/):

sh gen_bench_c_exe_scripts.sh /global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/runVAA3D.c /global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/jobs_text/2 /global/homes/z/zhizhou/bigneuron/BigNeuron_bench_test_LBNL_v1/Vaa3D_BigNeuron_version1/

3. sh gen_bench_pbs_scripts.sh <number of jobs> <number of nodes> <the output pbs file> <input folder including the executable file> <the executable file name>
<number of jobs>: number of running jobs are going to run
<number of nodes>: number of nodes are going to use
<the output pbs file>: the output job script
<input folder including the executable file>: only the folder path which includes the executable file generated by step 2
<the executable file name>: only the executable file name

This is one example to generate a test.pbs to submit 2000 jobs with 400 nodes.

sh gen_bench_pbs_scripts.sh 2000 400 /global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/test.pbs /global/project/projectdirs/m2043/BigNeuron/first2000_batch_run/ runVAA3D.exe

4. qsub test.pbs



